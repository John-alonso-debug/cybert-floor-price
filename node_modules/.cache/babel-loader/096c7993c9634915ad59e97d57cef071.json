{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar eachSeries_1 = __importDefault(require(\"async/eachSeries\"));\n\nvar base_provider_1 = __importDefault(require(\"./base-provider\"));\n\nvar provider_engine_error_1 = require(\"./errors/provider-engine-error\");\n\nvar block_tracker_1 = __importDefault(require(\"./util/block-tracker\"));\n\nvar stoplight_1 = __importDefault(require(\"./util/stoplight\"));\n\nvar Web3ProviderEngine =\n/** @class */\nfunction (_super) {\n  __extends(Web3ProviderEngine, _super);\n\n  function Web3ProviderEngine(opts) {\n    var _this = _super.call(this) || this;\n\n    _this._pollForBlocks = true;\n    _this._running = false;\n\n    _this.setMaxListeners(30); // parse options\n\n\n    opts = opts || {}; // block polling\n\n    var directProvider = {\n      sendAsync: function (req, cb) {\n        _this.sendPayload(req).then(function (res) {\n          cb(null, res);\n        }).catch(function (err) {\n          cb(err);\n        });\n      }\n    };\n\n    if (opts.disableBlockTracking === true) {\n      _this._pollForBlocks = false;\n    }\n\n    var blockTrackerProvider = opts.blockTrackerProvider || directProvider;\n    _this._blockTracker = new block_tracker_1.default({\n      provider: blockTrackerProvider,\n      blockTracker: opts.blockTracker,\n      pollingInterval: opts.pollingInterval || 4000\n    });\n\n    _this._blockTracker.on('block', _this._setCurrentBlock.bind(_this));\n\n    _this._blockTracker.on('sync', _this.emit.bind(_this, 'sync'));\n\n    _this._blockTracker.on('rawBlock', _this.emit.bind(_this, 'rawBlock'));\n\n    _this._blockTracker.on('latest', _this.emit.bind(_this, 'latest')); // Handle errors instead of re-emitting, since they will throw otherwise\n\n\n    _this._blockTracker.on('error', function (error) {\n      // Ignore errors from the block tracker unless debug is enabled\n      if (opts.debug) {\n        console.log('DEBUG: ' + error.message);\n      }\n    }); // set initialization blocker\n\n\n    _this._ready = new stoplight_1.default();\n    _this._providers = [];\n    return _this;\n  }\n\n  Web3ProviderEngine.prototype.isRunning = function () {\n    return this._running;\n  };\n\n  Web3ProviderEngine.prototype.start = function () {\n    // trigger start\n    this._ready.go();\n\n    if (this._pollForBlocks) {\n      // start tracking blocks\n      this._blockTracker.start();\n    } // update state\n\n\n    this._running = true; // signal that we started\n\n    this.emit('start');\n  };\n\n  Web3ProviderEngine.prototype.stop = function () {\n    // stop block tracking\n    this._blockTracker.stop(); // update state\n\n\n    this._running = false; // signal that we stopped\n\n    this.emit('stop');\n  };\n\n  Web3ProviderEngine.prototype.addProvider = function (source) {\n    this._providers.push(source);\n\n    source.setEngine(this);\n  };\n\n  Web3ProviderEngine.prototype.send = function (method, params) {\n    var _this = this; // Wrap base class with Stoplight\n\n\n    return new Promise(function (fulfill, reject) {\n      _this._ready.await(function () {\n        _super.prototype.send.call(_this, method, params).then(fulfill, reject);\n      });\n    });\n  };\n\n  Web3ProviderEngine.prototype.sendAsync = function (payload, cb) {\n    var _this = this; // Wrap base class with Stoplight\n\n\n    this._ready.await(function () {\n      _super.prototype.sendAsync.call(_this, payload, cb);\n    });\n  }; // Actually perform the request\n\n\n  Web3ProviderEngine.prototype.sendPayload = function (payload) {\n    var _this = this;\n\n    return new Promise(function (fulfill, reject) {\n      var currentProvider = -1;\n      var result = null;\n      var error = null; // Stack of subprovider next callbacks\n\n      var stack = [];\n\n      var next = function (callback) {\n        currentProvider += 1;\n\n        if (callback) {\n          // Insert in front since eachSeries traverses from front\n          stack.unshift(callback);\n        } // Bubbled down as far as we could go, and the request wasn't\n        // handled. Return an error.\n\n\n        if (currentProvider >= _this._providers.length) {\n          // tslint:disable-next-line: max-line-length\n          var msg = \"Request for method \\\"\" + payload.method + \"\\\" not handled by any subprovider.\";\n          end(new provider_engine_error_1.ProviderEngineError(msg, provider_engine_error_1.ProviderEngineErrorCode.UnhandledRequest));\n          return;\n        } // Handle request in next subprovider\n\n\n        try {\n          var provider = _this._providers[currentProvider];\n          provider.handleRequest(payload, next, end);\n        } catch (e) {\n          end(e);\n        }\n      };\n\n      var notifySubprovider = function (fn, callback) {\n        if (fn) {\n          fn(error, result, callback);\n        } else {\n          callback();\n        }\n      };\n\n      var end = function (e, r) {\n        error = e;\n        result = r; // Call any callbacks from subproviders\n\n        eachSeries_1.default(stack, notifySubprovider).then(function () {\n          // Reconstruct JSONRPCResponse\n          var resultObj = {\n            id: payload.id,\n            jsonrpc: payload.jsonrpc,\n            result: result\n          }; // Complete promise\n\n          if (error) {\n            reject(error);\n          } else {\n            fulfill(resultObj);\n          }\n        });\n      }; // Call next() to kick things off\n\n\n      next();\n    });\n  };\n\n  Web3ProviderEngine.prototype._setCurrentBlock = function (bufferBlock) {\n    this.currentBlock = bufferBlock;\n    this.emit('block', bufferBlock);\n  };\n\n  return Web3ProviderEngine;\n}(base_provider_1.default);\n\nexports.default = Web3ProviderEngine;","map":{"version":3,"sources":["/Users/helen/fi/protocol-demo/frontend/node_modules/@bitski/provider-engine/dist/provider-engine.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__importDefault","mod","__esModule","defineProperty","exports","value","eachSeries_1","require","base_provider_1","provider_engine_error_1","block_tracker_1","stoplight_1","Web3ProviderEngine","_super","opts","_this","call","_pollForBlocks","_running","setMaxListeners","directProvider","sendAsync","req","cb","sendPayload","then","res","catch","err","disableBlockTracking","blockTrackerProvider","_blockTracker","default","provider","blockTracker","pollingInterval","on","_setCurrentBlock","bind","emit","error","debug","console","log","message","_ready","_providers","isRunning","start","go","stop","addProvider","source","push","setEngine","send","method","params","Promise","fulfill","reject","await","payload","currentProvider","result","stack","next","callback","unshift","length","msg","end","ProviderEngineError","ProviderEngineErrorCode","UnhandledRequest","handleRequest","e","notifySubprovider","fn","r","resultObj","id","jsonrpc","bufferBlock","currentBlock"],"mappings":"AAAA;;AACA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIA,CAAC,CAACM,cAAF,CAAiBD,CAAjB,CAAJ,EAAyBN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAF9E;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASO,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBT,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACU,SAAF,GAAcT,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACS,MAAP,CAAcV,CAAd,CAAb,IAAiCO,EAAE,CAACE,SAAH,GAAeT,CAAC,CAACS,SAAjB,EAA4B,IAAIF,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaA,IAAII,eAAe,GAAI,QAAQ,KAAKA,eAAd,IAAkC,UAAUC,GAAV,EAAe;AACnE,SAAQA,GAAG,IAAIA,GAAG,CAACC,UAAZ,GAA0BD,GAA1B,GAAgC;AAAE,eAAWA;AAAb,GAAvC;AACH,CAFD;;AAGAX,MAAM,CAACa,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAIC,YAAY,GAAGN,eAAe,CAACO,OAAO,CAAC,kBAAD,CAAR,CAAlC;;AACA,IAAIC,eAAe,GAAGR,eAAe,CAACO,OAAO,CAAC,iBAAD,CAAR,CAArC;;AACA,IAAIE,uBAAuB,GAAGF,OAAO,CAAC,gCAAD,CAArC;;AACA,IAAIG,eAAe,GAAGV,eAAe,CAACO,OAAO,CAAC,sBAAD,CAAR,CAArC;;AACA,IAAII,WAAW,GAAGX,eAAe,CAACO,OAAO,CAAC,kBAAD,CAAR,CAAjC;;AACA,IAAIK,kBAAkB;AAAG;AAAe,UAAUC,MAAV,EAAkB;AACtD3B,EAAAA,SAAS,CAAC0B,kBAAD,EAAqBC,MAArB,CAAT;;AACA,WAASD,kBAAT,CAA4BE,IAA5B,EAAkC;AAC9B,QAAIC,KAAK,GAAGF,MAAM,CAACG,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACAD,IAAAA,KAAK,CAACE,cAAN,GAAuB,IAAvB;AACAF,IAAAA,KAAK,CAACG,QAAN,GAAiB,KAAjB;;AACAH,IAAAA,KAAK,CAACI,eAAN,CAAsB,EAAtB,EAJ8B,CAK9B;;;AACAL,IAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf,CAN8B,CAO9B;;AACA,QAAIM,cAAc,GAAG;AACjBC,MAAAA,SAAS,EAAE,UAAUC,GAAV,EAAeC,EAAf,EAAmB;AAC1BR,QAAAA,KAAK,CAACS,WAAN,CAAkBF,GAAlB,EAAuBG,IAAvB,CAA4B,UAAUC,GAAV,EAAe;AACvCH,UAAAA,EAAE,CAAC,IAAD,EAAOG,GAAP,CAAF;AACH,SAFD,EAEGC,KAFH,CAES,UAAUC,GAAV,EAAe;AACpBL,UAAAA,EAAE,CAACK,GAAD,CAAF;AACH,SAJD;AAKH;AAPgB,KAArB;;AASA,QAAId,IAAI,CAACe,oBAAL,KAA8B,IAAlC,EAAwC;AACpCd,MAAAA,KAAK,CAACE,cAAN,GAAuB,KAAvB;AACH;;AACD,QAAIa,oBAAoB,GAAGhB,IAAI,CAACgB,oBAAL,IAA6BV,cAAxD;AACAL,IAAAA,KAAK,CAACgB,aAAN,GAAsB,IAAIrB,eAAe,CAACsB,OAApB,CAA4B;AAC9CC,MAAAA,QAAQ,EAAEH,oBADoC;AAE9CI,MAAAA,YAAY,EAAEpB,IAAI,CAACoB,YAF2B;AAG9CC,MAAAA,eAAe,EAAErB,IAAI,CAACqB,eAAL,IAAwB;AAHK,KAA5B,CAAtB;;AAKApB,IAAAA,KAAK,CAACgB,aAAN,CAAoBK,EAApB,CAAuB,OAAvB,EAAgCrB,KAAK,CAACsB,gBAAN,CAAuBC,IAAvB,CAA4BvB,KAA5B,CAAhC;;AACAA,IAAAA,KAAK,CAACgB,aAAN,CAAoBK,EAApB,CAAuB,MAAvB,EAA+BrB,KAAK,CAACwB,IAAN,CAAWD,IAAX,CAAgBvB,KAAhB,EAAuB,MAAvB,CAA/B;;AACAA,IAAAA,KAAK,CAACgB,aAAN,CAAoBK,EAApB,CAAuB,UAAvB,EAAmCrB,KAAK,CAACwB,IAAN,CAAWD,IAAX,CAAgBvB,KAAhB,EAAuB,UAAvB,CAAnC;;AACAA,IAAAA,KAAK,CAACgB,aAAN,CAAoBK,EAApB,CAAuB,QAAvB,EAAiCrB,KAAK,CAACwB,IAAN,CAAWD,IAAX,CAAgBvB,KAAhB,EAAuB,QAAvB,CAAjC,EA7B8B,CA8B9B;;;AACAA,IAAAA,KAAK,CAACgB,aAAN,CAAoBK,EAApB,CAAuB,OAAvB,EAAgC,UAAUI,KAAV,EAAiB;AAC7C;AACA,UAAI1B,IAAI,CAAC2B,KAAT,EAAgB;AACZC,QAAAA,OAAO,CAACC,GAAR,CAAY,YAAYH,KAAK,CAACI,OAA9B;AACH;AACJ,KALD,EA/B8B,CAqC9B;;;AACA7B,IAAAA,KAAK,CAAC8B,MAAN,GAAe,IAAIlC,WAAW,CAACqB,OAAhB,EAAf;AACAjB,IAAAA,KAAK,CAAC+B,UAAN,GAAmB,EAAnB;AACA,WAAO/B,KAAP;AACH;;AACDH,EAAAA,kBAAkB,CAACd,SAAnB,CAA6BiD,SAA7B,GAAyC,YAAY;AACjD,WAAO,KAAK7B,QAAZ;AACH,GAFD;;AAGAN,EAAAA,kBAAkB,CAACd,SAAnB,CAA6BkD,KAA7B,GAAqC,YAAY;AAC7C;AACA,SAAKH,MAAL,CAAYI,EAAZ;;AACA,QAAI,KAAKhC,cAAT,EAAyB;AACrB;AACA,WAAKc,aAAL,CAAmBiB,KAAnB;AACH,KAN4C,CAO7C;;;AACA,SAAK9B,QAAL,GAAgB,IAAhB,CAR6C,CAS7C;;AACA,SAAKqB,IAAL,CAAU,OAAV;AACH,GAXD;;AAYA3B,EAAAA,kBAAkB,CAACd,SAAnB,CAA6BoD,IAA7B,GAAoC,YAAY;AAC5C;AACA,SAAKnB,aAAL,CAAmBmB,IAAnB,GAF4C,CAG5C;;;AACA,SAAKhC,QAAL,GAAgB,KAAhB,CAJ4C,CAK5C;;AACA,SAAKqB,IAAL,CAAU,MAAV;AACH,GAPD;;AAQA3B,EAAAA,kBAAkB,CAACd,SAAnB,CAA6BqD,WAA7B,GAA2C,UAAUC,MAAV,EAAkB;AACzD,SAAKN,UAAL,CAAgBO,IAAhB,CAAqBD,MAArB;;AACAA,IAAAA,MAAM,CAACE,SAAP,CAAiB,IAAjB;AACH,GAHD;;AAIA1C,EAAAA,kBAAkB,CAACd,SAAnB,CAA6ByD,IAA7B,GAAoC,UAAUC,MAAV,EAAkBC,MAAlB,EAA0B;AAC1D,QAAI1C,KAAK,GAAG,IAAZ,CAD0D,CAE1D;;;AACA,WAAO,IAAI2C,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC1C7C,MAAAA,KAAK,CAAC8B,MAAN,CAAagB,KAAb,CAAmB,YAAY;AAC3BhD,QAAAA,MAAM,CAACf,SAAP,CAAiByD,IAAjB,CAAsBvC,IAAtB,CAA2BD,KAA3B,EAAkCyC,MAAlC,EAA0CC,MAA1C,EAAkDhC,IAAlD,CAAuDkC,OAAvD,EAAgEC,MAAhE;AACH,OAFD;AAGH,KAJM,CAAP;AAKH,GARD;;AASAhD,EAAAA,kBAAkB,CAACd,SAAnB,CAA6BuB,SAA7B,GAAyC,UAAUyC,OAAV,EAAmBvC,EAAnB,EAAuB;AAC5D,QAAIR,KAAK,GAAG,IAAZ,CAD4D,CAE5D;;;AACA,SAAK8B,MAAL,CAAYgB,KAAZ,CAAkB,YAAY;AAC1BhD,MAAAA,MAAM,CAACf,SAAP,CAAiBuB,SAAjB,CAA2BL,IAA3B,CAAgCD,KAAhC,EAAuC+C,OAAvC,EAAgDvC,EAAhD;AACH,KAFD;AAGH,GAND,CAhFsD,CAuFtD;;;AACAX,EAAAA,kBAAkB,CAACd,SAAnB,CAA6B0B,WAA7B,GAA2C,UAAUsC,OAAV,EAAmB;AAC1D,QAAI/C,KAAK,GAAG,IAAZ;;AACA,WAAO,IAAI2C,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC1C,UAAIG,eAAe,GAAG,CAAC,CAAvB;AACA,UAAIC,MAAM,GAAG,IAAb;AACA,UAAIxB,KAAK,GAAG,IAAZ,CAH0C,CAI1C;;AACA,UAAIyB,KAAK,GAAG,EAAZ;;AACA,UAAIC,IAAI,GAAG,UAAUC,QAAV,EAAoB;AAC3BJ,QAAAA,eAAe,IAAI,CAAnB;;AACA,YAAII,QAAJ,EAAc;AACV;AACAF,UAAAA,KAAK,CAACG,OAAN,CAAcD,QAAd;AACH,SAL0B,CAM3B;AACA;;;AACA,YAAIJ,eAAe,IAAIhD,KAAK,CAAC+B,UAAN,CAAiBuB,MAAxC,EAAgD;AAC5C;AACA,cAAIC,GAAG,GAAG,0BAA0BR,OAAO,CAACN,MAAlC,GAA2C,oCAArD;AACAe,UAAAA,GAAG,CAAC,IAAI9D,uBAAuB,CAAC+D,mBAA5B,CAAgDF,GAAhD,EAAqD7D,uBAAuB,CAACgE,uBAAxB,CAAgDC,gBAArG,CAAD,CAAH;AACA;AACH,SAb0B,CAc3B;;;AACA,YAAI;AACA,cAAIzC,QAAQ,GAAGlB,KAAK,CAAC+B,UAAN,CAAiBiB,eAAjB,CAAf;AACA9B,UAAAA,QAAQ,CAAC0C,aAAT,CAAuBb,OAAvB,EAAgCI,IAAhC,EAAsCK,GAAtC;AACH,SAHD,CAIA,OAAOK,CAAP,EAAU;AACNL,UAAAA,GAAG,CAACK,CAAD,CAAH;AACH;AACJ,OAtBD;;AAuBA,UAAIC,iBAAiB,GAAG,UAAUC,EAAV,EAAcX,QAAd,EAAwB;AAC5C,YAAIW,EAAJ,EAAQ;AACJA,UAAAA,EAAE,CAACtC,KAAD,EAAQwB,MAAR,EAAgBG,QAAhB,CAAF;AACH,SAFD,MAGK;AACDA,UAAAA,QAAQ;AACX;AACJ,OAPD;;AAQA,UAAII,GAAG,GAAG,UAAUK,CAAV,EAAaG,CAAb,EAAgB;AACtBvC,QAAAA,KAAK,GAAGoC,CAAR;AACAZ,QAAAA,MAAM,GAAGe,CAAT,CAFsB,CAGtB;;AACAzE,QAAAA,YAAY,CAAC0B,OAAb,CAAqBiC,KAArB,EAA4BY,iBAA5B,EAA+CpD,IAA/C,CAAoD,YAAY;AAC5D;AACA,cAAIuD,SAAS,GAAG;AACZC,YAAAA,EAAE,EAAEnB,OAAO,CAACmB,EADA;AAEZC,YAAAA,OAAO,EAAEpB,OAAO,CAACoB,OAFL;AAGZlB,YAAAA,MAAM,EAAEA;AAHI,WAAhB,CAF4D,CAO5D;;AACA,cAAIxB,KAAJ,EAAW;AACPoB,YAAAA,MAAM,CAACpB,KAAD,CAAN;AACH,WAFD,MAGK;AACDmB,YAAAA,OAAO,CAACqB,SAAD,CAAP;AACH;AACJ,SAdD;AAeH,OAnBD,CArC0C,CAyD1C;;;AACAd,MAAAA,IAAI;AACP,KA3DM,CAAP;AA4DH,GA9DD;;AA+DAtD,EAAAA,kBAAkB,CAACd,SAAnB,CAA6BuC,gBAA7B,GAAgD,UAAU8C,WAAV,EAAuB;AACnE,SAAKC,YAAL,GAAoBD,WAApB;AACA,SAAK5C,IAAL,CAAU,OAAV,EAAmB4C,WAAnB;AACH,GAHD;;AAIA,SAAOvE,kBAAP;AACH,CA5JuC,CA4JtCJ,eAAe,CAACwB,OA5JsB,CAAxC;;AA6JA5B,OAAO,CAAC4B,OAAR,GAAkBpB,kBAAlB","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar eachSeries_1 = __importDefault(require(\"async/eachSeries\"));\nvar base_provider_1 = __importDefault(require(\"./base-provider\"));\nvar provider_engine_error_1 = require(\"./errors/provider-engine-error\");\nvar block_tracker_1 = __importDefault(require(\"./util/block-tracker\"));\nvar stoplight_1 = __importDefault(require(\"./util/stoplight\"));\nvar Web3ProviderEngine = /** @class */ (function (_super) {\n    __extends(Web3ProviderEngine, _super);\n    function Web3ProviderEngine(opts) {\n        var _this = _super.call(this) || this;\n        _this._pollForBlocks = true;\n        _this._running = false;\n        _this.setMaxListeners(30);\n        // parse options\n        opts = opts || {};\n        // block polling\n        var directProvider = {\n            sendAsync: function (req, cb) {\n                _this.sendPayload(req).then(function (res) {\n                    cb(null, res);\n                }).catch(function (err) {\n                    cb(err);\n                });\n            },\n        };\n        if (opts.disableBlockTracking === true) {\n            _this._pollForBlocks = false;\n        }\n        var blockTrackerProvider = opts.blockTrackerProvider || directProvider;\n        _this._blockTracker = new block_tracker_1.default({\n            provider: blockTrackerProvider,\n            blockTracker: opts.blockTracker,\n            pollingInterval: opts.pollingInterval || 4000,\n        });\n        _this._blockTracker.on('block', _this._setCurrentBlock.bind(_this));\n        _this._blockTracker.on('sync', _this.emit.bind(_this, 'sync'));\n        _this._blockTracker.on('rawBlock', _this.emit.bind(_this, 'rawBlock'));\n        _this._blockTracker.on('latest', _this.emit.bind(_this, 'latest'));\n        // Handle errors instead of re-emitting, since they will throw otherwise\n        _this._blockTracker.on('error', function (error) {\n            // Ignore errors from the block tracker unless debug is enabled\n            if (opts.debug) {\n                console.log('DEBUG: ' + error.message);\n            }\n        });\n        // set initialization blocker\n        _this._ready = new stoplight_1.default();\n        _this._providers = [];\n        return _this;\n    }\n    Web3ProviderEngine.prototype.isRunning = function () {\n        return this._running;\n    };\n    Web3ProviderEngine.prototype.start = function () {\n        // trigger start\n        this._ready.go();\n        if (this._pollForBlocks) {\n            // start tracking blocks\n            this._blockTracker.start();\n        }\n        // update state\n        this._running = true;\n        // signal that we started\n        this.emit('start');\n    };\n    Web3ProviderEngine.prototype.stop = function () {\n        // stop block tracking\n        this._blockTracker.stop();\n        // update state\n        this._running = false;\n        // signal that we stopped\n        this.emit('stop');\n    };\n    Web3ProviderEngine.prototype.addProvider = function (source) {\n        this._providers.push(source);\n        source.setEngine(this);\n    };\n    Web3ProviderEngine.prototype.send = function (method, params) {\n        var _this = this;\n        // Wrap base class with Stoplight\n        return new Promise(function (fulfill, reject) {\n            _this._ready.await(function () {\n                _super.prototype.send.call(_this, method, params).then(fulfill, reject);\n            });\n        });\n    };\n    Web3ProviderEngine.prototype.sendAsync = function (payload, cb) {\n        var _this = this;\n        // Wrap base class with Stoplight\n        this._ready.await(function () {\n            _super.prototype.sendAsync.call(_this, payload, cb);\n        });\n    };\n    // Actually perform the request\n    Web3ProviderEngine.prototype.sendPayload = function (payload) {\n        var _this = this;\n        return new Promise(function (fulfill, reject) {\n            var currentProvider = -1;\n            var result = null;\n            var error = null;\n            // Stack of subprovider next callbacks\n            var stack = [];\n            var next = function (callback) {\n                currentProvider += 1;\n                if (callback) {\n                    // Insert in front since eachSeries traverses from front\n                    stack.unshift(callback);\n                }\n                // Bubbled down as far as we could go, and the request wasn't\n                // handled. Return an error.\n                if (currentProvider >= _this._providers.length) {\n                    // tslint:disable-next-line: max-line-length\n                    var msg = \"Request for method \\\"\" + payload.method + \"\\\" not handled by any subprovider.\";\n                    end(new provider_engine_error_1.ProviderEngineError(msg, provider_engine_error_1.ProviderEngineErrorCode.UnhandledRequest));\n                    return;\n                }\n                // Handle request in next subprovider\n                try {\n                    var provider = _this._providers[currentProvider];\n                    provider.handleRequest(payload, next, end);\n                }\n                catch (e) {\n                    end(e);\n                }\n            };\n            var notifySubprovider = function (fn, callback) {\n                if (fn) {\n                    fn(error, result, callback);\n                }\n                else {\n                    callback();\n                }\n            };\n            var end = function (e, r) {\n                error = e;\n                result = r;\n                // Call any callbacks from subproviders\n                eachSeries_1.default(stack, notifySubprovider).then(function () {\n                    // Reconstruct JSONRPCResponse\n                    var resultObj = {\n                        id: payload.id,\n                        jsonrpc: payload.jsonrpc,\n                        result: result,\n                    };\n                    // Complete promise\n                    if (error) {\n                        reject(error);\n                    }\n                    else {\n                        fulfill(resultObj);\n                    }\n                });\n            };\n            // Call next() to kick things off\n            next();\n        });\n    };\n    Web3ProviderEngine.prototype._setCurrentBlock = function (bufferBlock) {\n        this.currentBlock = bufferBlock;\n        this.emit('block', bufferBlock);\n    };\n    return Web3ProviderEngine;\n}(base_provider_1.default));\nexports.default = Web3ProviderEngine;\n"]},"metadata":{},"sourceType":"script"}